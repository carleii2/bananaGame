<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Runaway Banana üçå</title>
  <style>
    canvas {
      display: block;
      margin: 0 auto;
      border: 2px solid black;
      background: skyblue;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ==================== GAME STATE ====================
let state = "start"; // start, playing, gameover
let score = 0;

// ==================== PLAYER ====================
const banana = {
  x: 50,
  y: 300,
  width: 40,
  height: 60,
  color: "yellow",
  dy: 0,
  gravity: 0.6,
  jumpPower: -12,
  grounded: true
};

// ==================== OBJECTS ====================
let obstacles = [];
let obstacleTimer = 0;
let peels = [];

// ==================== BACKGROUND LAYERS ====================
const backgroundLayers = [
  { color: "skyblue", speed: 0 },
  { color: "#a3d977", speed: 1 },
  { color: "#4caf50", speed: 2 },
  { color: "#3e2723", speed: 4 }
];
backgroundLayers.forEach(layer => layer.offset = 0);

// ==================== INPUT HANDLER ====================
document.addEventListener("keydown", (e) => {
  if (state === "start" && e.code === "Enter") {
    startGame();
  } else if (state === "playing") {
    if (e.code === "Space" && banana.grounded) {
      banana.dy = banana.jumpPower;
      banana.grounded = false;
    }
    if (e.code === "KeyB") {
      dropPeel();
    }
  }
});

// ==================== GAME FUNCTIONS ====================
function startGame() {
  state = "playing";
  score = 0;
  obstacles = [];
  peels = [];
  banana.y = 300;
  banana.dy = 0;
}

function gameOver() {
  state = "gameover";
}

function drawBanana() {
  // Banana body
  ctx.save();
  ctx.translate(banana.x + banana.width / 2, banana.y + banana.height / 2);
  ctx.rotate(-0.2); // slight tilt
  ctx.beginPath();
  ctx.moveTo(-15, 20);
  ctx.bezierCurveTo(-25, -20, 25, -20, 15, 20);
  ctx.lineTo(10, 25);
  ctx.bezierCurveTo(0, 35, -5, 35, -10, 25);
  ctx.closePath();
  ctx.fillStyle = "yellow";
  ctx.shadowColor = "#e6c200";
  ctx.shadowBlur = 10;
  ctx.fill();
  ctx.shadowBlur = 0;
  ctx.strokeStyle = "#e6c200";
  ctx.lineWidth = 2;
  ctx.stroke();

  // Banana tip (bottom)
  ctx.beginPath();
  ctx.arc(-10, 25, 3, 0, 2 * Math.PI);
  ctx.fillStyle = "#6d4c1b";
  ctx.fill();

  // Banana stem (top)
  ctx.beginPath();
  ctx.moveTo(10, -20);
  ctx.lineTo(15, -28);
  ctx.lineTo(7, -22);
  ctx.closePath();
  ctx.fillStyle = "#6d4c1b";
  ctx.fill();

  ctx.restore();
}

function updateBanana() {
  banana.y += banana.dy;
  banana.dy += banana.gravity;
  if (banana.y + banana.height >= 360) {
    banana.y = 360 - banana.height;
    banana.dy = 0;
    banana.grounded = true;
  }
}

// Obstacles
function drawObstacles() {
  ctx.fillStyle = "brown";
  obstacles.forEach((obs) => ctx.fillRect(obs.x, obs.y, obs.width, obs.height));
}
function updateObstacles() {
  obstacles.forEach(obs => obs.x -= 6);
  obstacles = obstacles.filter(obs => obs.x + obs.width > 0);
  obstacleTimer++;
  if (obstacleTimer > 100) {
    let height = 40 + Math.random() * 30;
    obstacles.push({x: canvas.width, y: 360 - height, width: 30, height: height});
    obstacleTimer = 0;
  }
}

// Peels
function dropPeel() {
  peels.push({x: banana.x, y: 360 - 15, width: 20, height: 10});
}
function drawPeels() {
  ctx.fillStyle = "gold";
  peels.forEach(peel => {
    ctx.beginPath();
    ctx.ellipse(peel.x+peel.width/2, peel.y+peel.height/2, 10, 5, 0, 0, 2 * Math.PI);
    ctx.fill();
  });
}
function updatePeels() {
  peels.forEach(peel => peel.x -= 6);
  peels = peels.filter(peel => peel.x + peel.width > 0);
  peels.forEach(peel => {
    obstacles = obstacles.filter(obs => {
      if (peel.x < obs.x + obs.width &&
          peel.x + peel.width > obs.x &&
          peel.y < obs.y + obs.height &&
          peel.y + peel.height > obs.y) {
        return false;
      }
      return true;
    });
  });
}

// Background
function drawBackground() {
  backgroundLayers.forEach((layer, index) => {
    if (state === "playing") layer.offset -= layer.speed;
    if (layer.offset <= -canvas.width) layer.offset = 0;
    ctx.fillStyle = layer.color;
    ctx.fillRect(layer.offset, 0, canvas.width, canvas.height);
    ctx.fillRect(layer.offset + canvas.width, 0, canvas.width, canvas.height);

    if (index > 0) {
      ctx.fillStyle = (index === 3 ? "#2e7d32" : "green");
      for (let i = 0; i < 10; i++) {
        let x = (i * 150 + layer.offset * (index+1)) % canvas.width;
        let h = 50 + index * 20;
        ctx.fillRect(x, 360 - h, 20, h);
      }
    }
  });
}

// Collision
function checkCollision() {
  for (let obs of obstacles) {
    if (banana.x < obs.x + obs.width &&
        banana.x + banana.width > obs.x &&
        banana.y < obs.y + obs.height &&
        banana.y + banana.height > obs.y) {
      gameOver();
    }
  }
}

// UI
function drawScore() {
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Score: " + score, 10, 30);
}

// ==================== GAME LOOP ====================
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Background always
  drawBackground();

  if (state === "start") {
    ctx.fillStyle = "white";
    ctx.font = "50px Arial Black";
    ctx.fillText("RUNAWAY BANANA üçå", canvas.width/2 - 250, 150);
    ctx.font = "20px Arial";
    ctx.fillText("Press ENTER to Start", canvas.width/2 - 100, 200);
    ctx.fillText("Controls:", canvas.width/2 - 50, 250);
    ctx.fillText("Space = Jump", canvas.width/2 - 50, 280);
    ctx.fillText("B = Drop Peel", canvas.width/2 - 50, 310);
    drawBanana();
  } 
  else if (state === "playing") {
    updateBanana();
    updateObstacles();
    updatePeels();
    checkCollision();
    score++;
    drawBanana();
    drawObstacles();
    drawPeels();
    drawScore();
  } 
  else if (state === "gameover") {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText("GAME OVER üçå", canvas.width/2 - 120, canvas.height/2);
    ctx.font = "20px Arial";
    ctx.fillText("Press ENTER to Restart", canvas.width/2 - 100, canvas.height/2 + 40);
  }

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
